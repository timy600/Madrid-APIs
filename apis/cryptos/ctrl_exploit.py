""" Controller exploit
Exploiting crypto data.
"""
from flask import jsonify
from flask_restx import Resource

from apis.models.config import sql_to_df
from apis.utils import get_general_response, get_order_response

from .dto import CryptoDTO

api = CryptoDTO.api


@api.route("/db/<order>/<symbol>")
class Orders(Resource):
    """Show orders."""

    def get(self, order, symbol):
        df = sql_to_df()
        df = df[(df["order_type"] == order) & (df["symbol"] == symbol)]
        # print(df.describe())
        response = get_order_response(df)
        return jsonify(response)


@api.route("/history/<order>/<symbol>")
class HistoricValues(Resource):
    """Show historic values for an order and a symbol."""

    def get(self, order, symbol):
        df = sql_to_df()
        df = df[(df["order_type"] == order) & (df["symbol"] == symbol)]
        # print(df.describe())
        response = df[["px", "qty"]].to_json()
        return jsonify(response)


@api.route("/db/general")
class GeneralStats(Resource):
    """Show general statistics."""

    def get(self):
        df = sql_to_df()
        print(df.describe())
        response = get_general_response(df)
        return jsonify(response)
        # return True
